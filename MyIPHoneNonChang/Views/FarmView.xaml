<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MyIPHoneNonChang.Views.FarmView"
             xmlns:vm="clr-namespace:MyIPHoneNonChang.ViewModels"
             Title="FarmView">

    <!--
    <ContentPage.BindingContext>
        <vm:FramViewModel/>
    </ContentPage.BindingContext>
    -->

    <ScrollView>

        <VerticalStackLayout>
            <VerticalStackLayout.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#0FC97D" Offset="0"/>
                    <GradientStop Color="#F5F9F9" Offset="0.3"/>
                </LinearGradientBrush>
            </VerticalStackLayout.Background>

            <HorizontalStackLayout HeightRequest="30" Margin="10,40,10,0">
                <Image Source="logo_65.png" Margin="10,0"/>
                <Label Text="文君-智慧农业"
                       VerticalOptions="Center"
                       TextColor="White"
                       FontSize="16"
                       FontAttributes="Bold"/>
            </HorizontalStackLayout>

            <Frame HeightRequest="170"
                   HasShadow="True"
                   CornerRadius="15"
                   Padding="0"
                   Margin="15">
                <!--  CommunityToolkit.MAUI 这里可以监控摄像头的.. MediaElement  -->
                <Image Source="dp.jpg" Aspect="AspectFill"/>
            </Frame>

            <Label Margin="15,10" HorizontalOptions="Start">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="实时视频（"
                              FontAttributes="Bold"
                              TextColor="#555"/>
                        <Span Text="{Binding CameraList.Count}"
                              FontAttributes="Bold"
                              TextColor="#555"/>
                        <Span Text="）"
                              FontAttributes="Bold"
                              TextColor="#555"/>
                    </FormattedString>
                </Label.FormattedText>
            </Label>

            <CollectionView ItemsSource="{Binding CameraList}" HeightRequest="90">
                <CollectionView.Header>
                    <Label WidthRequest="10"/>
                </CollectionView.Header>
                <CollectionView.Footer>
                    <Label WidthRequest="10"/>
                </CollectionView.Footer>
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Horizontal"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="0"
                               HasShadow="True"
                               CornerRadius="10"
                               Margin="4"
                               BorderColor="Transparent"
                               WidthRequest="120">
                            <Grid>
                                <Image Source="{Binding}" Aspect="AspectFill"/>
                                <Ellipse WidthRequest="26"
                                         HeightRequest="26"
                                         Fill="#66000000"
                                         Stroke="White"
                                         StrokeThickness="1"
                                         VerticalOptions="Center"
                                         HorizontalOptions="Center"/>
                                <Path Data="M0 0 10 6 0 12"
                                      Fill="White"
                                      Margin="1,0,0,0"
                                      VerticalOptions="Center"
                                      HorizontalOptions="Center"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>


            <Label Margin="15,10" HorizontalOptions="Start">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="异常信息（"
                              FontAttributes="Bold"
                              TextColor="#555"/>
                        <Span Text="{Binding ErrorList.Count}"
                              FontAttributes="Bold"
                              TextColor="#555"/>
                        <Span Text="）"
                              FontAttributes="Bold"
                              TextColor="#555"/>
                    </FormattedString>
                </Label.FormattedText>
            </Label>

            <CollectionView ItemsSource="{Binding ErrorList}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="0"
                               Background="White"
                               CornerRadius="10"
                               BorderColor="Transparent"
                               Margin="15,5"
                               HeightRequest="65">
                            <Grid ColumnDefinitions="50,*,0.8*">
                                <Path Data="M512 0c282.760533 0 512 229.239467 512 512 0 282.760533-229.239467 512-512 512-282.760533 0-512-229.239467-512-512C0 229.239467 229.239467 0 512 0z m9.728 382.2592l-17.032533 0.273067-18.295467 1.570133-1.467733 0.238933a166.946133 166.946133 0 0 0-49.186134 17.2032c-34.133333 18.875733-56.32 45.533867-67.7888 81.373867-5.358933 16.725333-5.085867 37.853867-4.8128 58.333867l0.1024 12.629333v128.1024H320.170667v42.837333h385.365333V681.984h-43.008V553.642667l0.1024-12.4928c0.238933-20.411733 0.512-41.472-4.778667-58.197334-15.189333-47.547733-49.937067-80.384-100.488533-94.958933-8.2944-2.389333-16.452267-3.345067-25.053867-4.369067-3.072-0.341333-6.280533-0.750933-9.557333-1.194666l-1.024-0.136534z m-287.163733 85.640533v42.8032H320.170667V467.968l-85.674667-0.034133z m471.04 0v42.8032h85.640533V467.968l-85.674667-0.034133zM341.572267 296.618667l-21.367467 21.367466 64.273067 64.273067 21.367466-21.4016-64.273066-64.238933z m342.664533 0l-64.273067 64.238933 21.367467 21.4016 64.273067-64.273067-21.367467-21.367466z m-149.9136-42.837334h-42.837333v85.640534h42.837333v-85.674667z"
                                      WidthRequest="30"
                                      HeightRequest="30"
                                      Aspect="Fill">
                                    <Path.Fill>
                                        <SolidColorBrush Color="{Binding Color}"/>
                                    </Path.Fill>
                                </Path>


                                <StackLayout Grid.Column="1"
                                             VerticalOptions="Center"
                                             Spacing="4">
                                    <Label Text="{Binding Header}"
                                           FontAttributes="Bold"
                                           FontSize="15"/>
                                    <Label Text="{Binding Description}"
                                           FontSize="12"
                                           TextColor="{Binding Color}"/>
                                </StackLayout>

                                <Frame Grid.Column="2"
                                       HeightRequest="33"
                                       CornerRadius="16"
                                       Padding="0"
                                       Margin="5,0"
                                       BorderColor="#E4EFF1"
                                       Background="#F2F7FC">
                                    <StackLayout Orientation="Horizontal"
                                                 VerticalOptions="Center"
                                                 HorizontalOptions="Center">
                                        <Path Data="M898 541.88c-15.6-16-31.6-32-47.2-48-90.8-91.2-182.8-181.6-273.2-273.6l-48-48c-7.6-9.6-22-11.6-31.6-3.6-1.2 1.2-2.8 2.4-3.6 3.6-21.2 21.2-42 42.4-63.2 64-100.8 101.6-202.8 202.8-303.6 304.8l-2.4 2.4c-3.6 4-5.2 9.2-4.8 14.8 0.4 12 10.4 21.2 22.4 21.2H245.2c4 0 5.6 0.8 5.2 5.2v126.8c0 41.6 0.4 83.2 0 124.8-0.8 12.8 9.2 24 22 24.4h480c12.8 0.4 24-9.6 24.4-22.4v-2c-0.4-83.6 0-167.6 0-251.2 0-5.6 0-5.6 5.6-5.6h100c9.2 0 17.2-5.6 20-14 3.2-8.4 1.2-17.6-4.4-23.6z m-74.4-6.8c-22.4 0-44.8 0.4-66.8 0-12.8-0.4-23.6 9.6-24 22.4v1.6c0.4 83.6 0 167.6 0 251.2 0 5.6 0 6-5.6 6H300c-4.4 0-5.6-1.2-5.6-5.6v-251.6c1.2-12-7.6-22.8-20-24H196c0.8-1.6 2-3.2 3.2-4.4 60.4-60.4 121.2-120.8 181.6-182 42.4-42.8 85.2-85.2 127.6-128 2.8-2.8 4.4-2.8 7.2 0 37.6 38 75.6 75.2 112.8 113.2 64.8 66.4 131.2 131.2 196.4 197.2 0.8 0.8 2 2 3.2 3.6l-4.4 0.4zM632.8 601.48c-2.4-6.4-6-12.4-11.2-17.2-5.6-5.2-12-9.2-19.2-11.6-8.8-2.8-17.6-3.6-26.8-2.4-7.2 0.8-14.4 2.4-21.2 5.2-7.2 2.8-14 6.4-20.8 10.4-6.4 4-12.4 8.8-18 14.4-5.2 4.8-9.6 10.4-13.2 16.8-3.2-6.8-7.2-12.8-11.6-18.8-4.8-6.4-10-12-15.2-17.6-5.2-5.2-11.2-10.4-17.2-14.8-5.2-4-10.8-7.2-16.8-10-5.2-2.4-10.4-4-16-5.2-5.2-1.2-10.8-1.6-16.4-1.2-5.2 0-10 1.2-14.8 2.8-4.4 1.6-8.4 4-12 7.2-3.6 3.6-7.2 8-10 12.4s-4.8 9.6-5.6 14.8c-0.8 5.2-0.8 10.8 0.8 16 1.6 5.6 13.6 49.6 85.6 68.4 8.4 2.4 17.6 2.4 26 0.4-2.8 12-5.2 25.2-7.2 40-2 15.6-3.2 31.2-3.2 46.8 0 12.8 0 23.6-0.4 32.4 0 8.8-0.4 16-0.8 21.2-0.4 6.4-0.8 11.6-0.8 15.6h36.8c-0.8-6.4-1.2-13.2-1.6-20-0.4-6-0.8-12.8-1.2-20s-0.4-14.8-0.4-22c0-15.2 0.8-30.8 2.8-46 2-14.8 4.4-28.8 6.8-41.2 89.2 10 114.4-33.6 118-39.2 3.6-5.6 5.6-11.6 6.4-18 1.2-6.8 0.4-13.6-1.6-19.6z"
                                              Fill="#72848A"
                                              WidthRequest="18"
                                              HeightRequest="18"
                                              Aspect="Uniform"/>
                                        <Label Text="{Binding Address}"
                                               VerticalOptions="Center"
                                               FontSize="12"/>
                                    </StackLayout>
                                </Frame>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Grid ColumnDefinitions="*,60,auto"
                  RowDefinitions="*,*"
                  HeightRequest="50"
                  Margin="15,10">
                <Label Text="气象站"
                       FontAttributes="Bold"
                       TextColor="#555"
                       VerticalOptions="Center"
                       HorizontalOptions="Start"/>
                <Label Text="刷新时间：10:00"
                       Grid.Row="1"
                       FontSize="12"
                       TextColor="#AAA"/>

                <Frame Grid.Column="1"
                       Grid.RowSpan="2"
                       Padding="0"
                       HeightRequest="32"
                       CornerRadius="16">
                    <Button Text="设置"
                            Padding="0"
                            FontSize="12"
                            Background="#0AC677"
                            Command="{Binding SettingsCommand}"/>
                </Frame>


                <Frame Grid.Column="2"
                       Grid.RowSpan="2"
                       Padding="0"
                       Margin="3,0"
                       HeightRequest="32"
                       WidthRequest="80"
                       CornerRadius="16">
                    <Button Text="数据分析"
                            Padding="0"
                            FontSize="12"
                            Background="#2F92F7"
                            Command="{Binding DataCommand}"/>
                </Frame>

            </Grid>

            <CollectionView ItemsSource="{Binding MonitorList}"
                            ItemsLayout="VerticalGrid,2"
                            Margin="10,0">
                <CollectionView.Footer>
                    <Label Text="----没有更多了----"
                           FontSize="10"
                           TextColor="#888"
                           Margin="0,10,0,20"
                           HorizontalOptions="Center"/>
                </CollectionView.Footer>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="0"
                               CornerRadius="5"
                               BackgroundColor="White"
                               BorderColor="Transparent"
                               Margin="5">
                            <Grid RowDefinitions="30,26,12"
                                  ColumnDefinitions="70,80"
                                  Padding="10">
                                <Label Text="{Binding Header}"
                                       FontAttributes="Bold"
                                       LineBreakMode="TailTruncation"/>
                                <Label Grid.Row="1" FontSize="12">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding Value}"
                                                  TextColor="{Binding TextColor}"
                                                  FontAttributes="Bold"/>
                                            <Span Text="{Binding Unit}" TextColor="{Binding TextColor}"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label Grid.Row="2" FontSize="10">
                                    <Label.Triggers>
                                        <!--这里理解一下，如果为0就不显示-->
                                        <DataTrigger Binding="{Binding ChangeFlag}"
                                                     Value="0"
                                                     TargetType="Label">
                                            <Setter Property="IsVisible" Value="False"/>
                                        </DataTrigger>
                                    </Label.Triggers>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="&#xe8f5;"
                                                  FontFamily="Iconfont"
                                                  TextColor="{Binding TextColor}"/>
                                            <Span Text="{Binding ChangeValue}" TextColor="{Binding TextColor}"/>
                                            <Span Text="{Binding Unit}" TextColor="{Binding TextColor}"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Ellipse WidthRequest="40"
                                         HeightRequest="40"
                                         Fill="#F2F7FC"
                                         Grid.Column="1"
                                         Grid.RowSpan="3"/>
                                <Label Text="{Binding Icon}"
                                       FontFamily="Iconfont"
                                       Grid.Column="1"
                                       Grid.RowSpan="3"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Center"
                                       FontSize="22"
                                       TextColor="#555"/>

                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>